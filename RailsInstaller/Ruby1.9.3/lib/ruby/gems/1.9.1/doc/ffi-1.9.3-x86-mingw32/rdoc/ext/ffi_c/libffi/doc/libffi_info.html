<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>libffi.info - ffi-1.9.3-x86-mingw32 Documentation</title>

<link href="../../../../fonts.css" rel="stylesheet">
<link href="../../../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../../";
</script>

<script src="../../../../js/jquery.js"></script>
<script src="../../../../js/navigation.js"></script>
<script src="../../../../js/search_index.js"></script>
<script src="../../../../js/search.js"></script>
<script src="../../../../js/searcher.js"></script>
<script src="../../../../js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-"></a>
    <li><a href="#label-"></a>
    <li><a href="#label-"></a>
    <li><a href="#label-"></a>
    <li><a href="#label-"></a>
    <li><a href="#label-"></a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../../ext/ffi_c/libffi/ChangeLog.html">ChangeLog</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/ChangeLog_libffi.html">ChangeLog.libffi</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/ChangeLog_libgcj.html">ChangeLog.libgcj</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/ChangeLog_v1.html">ChangeLog.v1</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/Makefile_am.html">Makefile.am</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/Makefile_in.html">Makefile.in</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/Makefile_vc.html">Makefile.vc</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/Makefile_vc64.html">Makefile.vc64</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/README.html">README</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/acinclude_m4.html">acinclude.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/build-ios_sh.html">build-ios.sh</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/compile.html">compile</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/config_guess.html">config.guess</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/config_sub.html">config.sub</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/configure.html">configure</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/configure_ac.html">configure.ac</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/configure_host.html">configure.host</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/depcomp.html">depcomp</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/doc/libffi_info.html">libffi.info</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/doc/stamp-vti.html">stamp-vti</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/doc/version_texi.html">version.texi</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/fficonfig_h_in.html">fficonfig.h.in</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/include/Makefile_am.html">Makefile.am</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/include/Makefile_in.html">Makefile.in</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/install-sh.html">install-sh</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/libffi_pc_in.html">libffi.pc.in</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/libtool-version.html">libtool-version</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/ltmain_sh.html">ltmain.sh</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/m4/ax_cc_maxopt_m4.html">ax_cc_maxopt.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/m4/ax_cflags_warn_all_m4.html">ax_cflags_warn_all.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/m4/ax_check_compiler_flags_m4.html">ax_check_compiler_flags.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/m4/ax_compiler_vendor_m4.html">ax_compiler_vendor.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/m4/ax_configure_args_m4.html">ax_configure_args.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/m4/ax_enable_builddir_m4.html">ax_enable_builddir.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/m4/ax_gcc_archflag_m4.html">ax_gcc_archflag.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/m4/ax_gcc_x86_cpuid_m4.html">ax_gcc_x86_cpuid.m4</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/man/Makefile_am.html">Makefile.am</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/man/Makefile_in.html">Makefile.in</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/man/ffi_3.html">ffi.3</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/man/ffi_call_3.html">ffi_call.3</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/man/ffi_prep_cif_3.html">ffi_prep_cif.3</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/mdate-sh.html">mdate-sh</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/missing.html">missing</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/msvcc_sh.html">msvcc.sh</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/alpha/osf_S.html">osf.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/arm/gentramp_sh.html">gentramp.sh</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/arm/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/arm/trampoline_S.html">trampoline.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/avr32/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/cris/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/frv/eabi_S.html">eabi.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/ia64/unix_S.html">unix.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/m32r/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/m68k/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/mips/n32_S.html">n32.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/mips/o32_S.html">o32.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/moxie/eabi_S.html">eabi.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/pa/hpux32_S.html">hpux32.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/pa/linux_S.html">linux.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/powerpc/aix_S.html">aix.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/powerpc/aix_closure_S.html">aix_closure.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/powerpc/darwin_S.html">darwin.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/powerpc/darwin_closure_S.html">darwin_closure.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/powerpc/linux64_S.html">linux64.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/powerpc/linux64_closure_S.html">linux64_closure.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/powerpc/ppc_closure_S.html">ppc_closure.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/powerpc/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/s390/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/sh/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/sh64/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/sparc/v8_S.html">v8.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/sparc/v9_S.html">v9.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/x86/darwin_S.html">darwin.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/x86/darwin64_S.html">darwin64.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/x86/freebsd_S.html">freebsd.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/x86/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/x86/unix64_S.html">unix64.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/x86/win32_S.html">win32.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/src/x86/win64_S.html">win64.S</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/Makefile_am.html">Makefile.am</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/Makefile_in.html">Makefile.in</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/config/default_exp.html">default.exp</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/lib/libffi-dg_exp.html">libffi-dg.exp</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/lib/libffi_exp.html">libffi.exp</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/lib/target-libpath_exp.html">target-libpath.exp</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/lib/wrapper_exp.html">wrapper.exp</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/libffi_call/call_exp.html">call.exp</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/testsuite/libffi_special/special_exp.html">special.exp</a>
  
    <li><a href="../../../../ext/ffi_c/libffi/texinfo_tex.html">texinfo.tex</a>
  
    <li><a href="../../../../lib/ffi/platform/arm-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-cygwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-darwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-freebsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-gnu/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-netbsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-openbsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-solaris/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/i386-windows/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/ia64-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/mips-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/mipsel-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/powerpc-aix/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/powerpc-darwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/powerpc-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/s390-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/s390x-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/sparc-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/sparc-solaris/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/sparcv9-solaris/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/x86_64-cygwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/x86_64-darwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/x86_64-freebsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/x86_64-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/x86_64-netbsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/x86_64-openbsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/x86_64-solaris/types_conf.html">types.conf</a>
  
    <li><a href="../../../../lib/ffi/platform/x86_64-windows/types_conf.html">types.conf</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page ext/ffi_c/libffi/doc/libffi.info">

<p>This is ../libffi/doc/libffi.info, produced by makeinfo version 4.13 from
../libffi/doc/libffi.texi.</p>

<p>This manual is for Libffi, a portable foreign-function interface library.</p>

<pre>Copyright (C) 2008, 2010 Red Hat, Inc.

  Permission is granted to copy, distribute and/or modify this
  document under the terms of the GNU General Public License as
  published by the Free Software Foundation; either version 2, or
  (at your option) any later version.  A copy of the license is
  included in the section entitled &quot;GNU General Public License&quot;.</pre>

<p>INFO-DIR-SECTION Development START-INFO-DIR-ENTRY</p>

<pre>libffi: (libffi).             Portable foreign-function interface library.</pre>

<p>END-INFO-DIR-ENTRY</p>

<p> File: libffi.info,  Node: Top,  Next: Introduction,  Up: (dir)</p>

<p>libffi</p>

<pre>****</pre>

<p>This manual is for Libffi, a portable foreign-function interface library.</p>

<pre> Copyright (C) 2008, 2010 Red Hat, Inc.

   Permission is granted to copy, distribute and/or modify this
   document under the terms of the GNU General Public License as
   published by the Free Software Foundation; either version 2, or
   (at your option) any later version.  A copy of the license is
   included in the section entitled &quot;GNU General Public License&quot;.

Menu:

Introduction::                What is libffi?
Using libffi::                How to use libffi.
Missing Features::            Things libffi can't do.
Index::                       Index.</pre>

<p> File: libffi.info,  Node: Introduction,  Next: Using libffi,  Prev: Top, 
Up: Top</p>

<p>1 What is libffi?</p>

<pre>***************</pre>

<p>Compilers for high level languages generate code that follow certain
conventions.  These conventions are necessary, in part, for separate
compilation to work.  One such convention is the “calling convention”. The
calling convention is a set of assumptions made by the compiler about where
function arguments will be found on entry to a function.  A calling
convention also specifies where the return value for a function is found. 
The calling convention is also sometimes called the “ABI” or “Application
Binary Interface”.</p>

<pre>Some programs may not know at the time of compilation what arguments</pre>

<p>are to be passed to a function.  For instance, an interpreter may be told
at run-time about the number and types of arguments used to call a given
function.  `Libffi’ can be used in such programs to provide a bridge from
the interpreter program to compiled code.</p>

<pre>The `libffi' library provides a portable, high level programming</pre>

<p>interface to various calling conventions.  This allows a programmer to call
any function specified by a call interface description at run time.</p>

<pre>FFI stands for Foreign Function Interface.  A foreign function</pre>

<p>interface is the popular name for the interface that allows code written in
one language to call code written in another language.  The `libffi’
library really only provides the lowest, machine dependent layer of a fully
featured foreign function interface.  A layer must exist above `libffi’
that handles type conversions for values passed between the two languages.</p>

<p> File: libffi.info,  Node: Using libffi,  Next: Missing Features,  Prev:
Introduction,  Up: Top</p>

<p>2 Using libffi</p>

<pre>************

Menu:

The Basics::                  The basic libffi API.
Simple Example::              A simple example.
Types::                       libffi type descriptions.
Multiple ABIs::               Different passing styles on one platform.
The Closure API::             Writing a generic function.
Closure Example::             A closure example.</pre>

<p> File: libffi.info,  Node: The Basics,  Next: Simple Example,  Up: Using
libffi</p>

<p>2.1 The Basics</p>

<h6 id="label-"><span><a href="#label-">&para;</a> <a href="#documentation">&uarr;</a></span></h6>

<p>`Libffi’ assumes that you have a pointer to the function you wish to call
and that you know the number and types of arguments to pass it, as well as
the return type of the function.</p>

<pre>The first thing you must do is create an `ffi_cif' object that</pre>

<p>matches the signature of the function you wish to call.  This is a separate
step because it is common to make multiple calls using a single `ffi_cif’. 
The “cif” in `ffi_cif’ stands for Call InterFace. To prepare a call
interface object, use the function `ffi_prep_cif’.</p>

<pre>-- Function: ffi_status ffi_prep_cif (ffi_cif *CIF, ffi_abi ABI,
         unsigned int NARGS, ffi_type *RTYPE, ffi_type **ARGTYPES)
    This initializes CIF according to the given parameters.

    ABI is the ABI to use; normally `FFI_DEFAULT_ABI' is what you
    want.  *note Multiple ABIs:: for more information.

    NARGS is the number of arguments that this function accepts.
    `libffi' does not yet handle varargs functions; see *note Missing
    Features:: for more information.

    RTYPE is a pointer to an `ffi_type' structure that describes the
    return type of the function.  *Note Types::.

    ARGTYPES is a vector of `ffi_type' pointers.  ARGTYPES must have
    NARGS elements.  If NARGS is 0, this argument is ignored.

    `ffi_prep_cif' returns a `libffi' status code, of type
    `ffi_status'.  This will be either `FFI_OK' if everything worked
    properly; `FFI_BAD_TYPEDEF' if one of the `ffi_type' objects is
    incorrect; or `FFI_BAD_ABI' if the ABI parameter is invalid.

  To call a function using an initialized `ffi_cif', use the</pre>

<p>`ffi_call’ function:</p>

<pre>-- Function: void ffi_call (ffi_cif *CIF, void *FN, void *RVALUE, void
           AVALUES)
    This calls the function FN according to the description given in
    CIF.  CIF must have already been prepared using `ffi_prep_cif'.

    RVALUE is a pointer to a chunk of memory that will hold the result
    of the function call.  This must be large enough to hold the
    result and must be suitably aligned; it is the caller's
    responsibility to ensure this.  If CIF declares that the function
    returns `void' (using `ffi_type_void'), then RVALUE is ignored.
    If RVALUE is `NULL', then the return value is discarded.

    AVALUES is a vector of `void *' pointers that point to the memory
    locations holding the argument values for a call.  If CIF declares
    that the function has no arguments (i.e., NARGS was 0), then
    AVALUES is ignored.  Note that argument values may be modified by
    the callee (for instance, structs passed by value); the burden of
    copying pass-by-value arguments is placed on the caller.</pre>

<p> File: libffi.info,  Node: Simple Example,  Next: Types,  Prev: The
Basics,  Up: Using libffi</p>

<p>2.2 Simple Example</p>

<h6 id="label-"><span><a href="#label-">&para;</a> <a href="#documentation">&uarr;</a></span></h6>

<p>Here is a trivial example that calls `puts’ a few times.</p>

<pre>#include &lt;stdio.h&gt;
#include &lt;ffi.h&gt;

int main()
{
  ffi_cif cif;
  ffi_type *args[1];
  void *values[1];
  char *s;
  int rc;

     Initialize the argument info vectors   
  args[0] = &amp;ffi_type_pointer;
  values[0] = &amp;s;

     Initialize the cif   
  if (ffi_prep_cif(&amp;cif, FFI_DEFAULT_ABI, 1,
                  &amp;ffi_type_uint, args) == FFI_OK)
    {
      s = &quot;Hello World!&quot;;
      ffi_call(&amp;cif, puts, &amp;rc, values);
      /* rc now holds the result of the call to puts */

      /* values holds a pointer to the function's arg, so to
         call puts() again all we need to do is change the
         value of s */
      s = &quot;This is cool!&quot;;
      ffi_call(&amp;cif, puts, &amp;rc, values);
    }

  return 0;
}</pre>

<p> File: libffi.info,  Node: Types,  Next: Multiple ABIs,  Prev: Simple
Example,  Up: Using libffi</p>

<p>2.3 Types</p>

<h6 id="label-"><span><a href="#label-">&para;</a> <a href="#documentation">&uarr;</a></span></h6>

<pre>Menu:

Primitive Types::             Built-in types.
Structures::                  Structure types.
Type Example::                Structure type example.</pre>

<p> File: libffi.info,  Node: Primitive Types,  Next: Structures,  Up: Types</p>

<p>2.3.1 Primitive Types</p>
<hr>

<p>`Libffi’ provides a number of built-in type descriptors that can be used to
describe argument and return types:</p>

<p>`ffi_type_void’</p>

<pre>The type `void'.  This cannot be used for argument types, only for
return values.</pre>

<p>`ffi_type_uint8’</p>

<pre>An unsigned, 8-bit integer type.</pre>

<p>`ffi_type_sint8’</p>

<pre>A signed, 8-bit integer type.</pre>

<p>`ffi_type_uint16’</p>

<pre>An unsigned, 16-bit integer type.</pre>

<p>`ffi_type_sint16’</p>

<pre>A signed, 16-bit integer type.</pre>

<p>`ffi_type_uint32’</p>

<pre>An unsigned, 32-bit integer type.</pre>

<p>`ffi_type_sint32’</p>

<pre>A signed, 32-bit integer type.</pre>

<p>`ffi_type_uint64’</p>

<pre>An unsigned, 64-bit integer type.</pre>

<p>`ffi_type_sint64’</p>

<pre>A signed, 64-bit integer type.</pre>

<p>`ffi_type_float’</p>

<pre>The C `float' type.</pre>

<p>`ffi_type_double’</p>

<pre>The C `double' type.</pre>

<p>`ffi_type_uchar’</p>

<pre>The C `unsigned char' type.</pre>

<p>`ffi_type_schar’</p>

<pre>The C `signed char' type.  (Note that there is not an exact
equivalent to the C `char' type in `libffi'; ordinarily you should
either use `ffi_type_schar' or `ffi_type_uchar' depending on
whether `char' is signed.)</pre>

<p>`ffi_type_ushort’</p>

<pre>The C `unsigned short' type.</pre>

<p>`ffi_type_sshort’</p>

<pre>The C `short' type.</pre>

<p>`ffi_type_uint’</p>

<pre>The C `unsigned int' type.</pre>

<p>`ffi_type_sint’</p>

<pre>The C `int' type.</pre>

<p>`ffi_type_ulong’</p>

<pre>The C `unsigned long' type.</pre>

<p>`ffi_type_slong’</p>

<pre>The C `long' type.</pre>

<p>`ffi_type_longdouble’</p>

<pre>On platforms that have a C `long double' type, this is defined.
On other platforms, it is not.</pre>

<p>`ffi_type_pointer’</p>

<pre>  A generic `void *' pointer.  You should use this for all pointers,
  regardless of their real type.

Each of these is of type `ffi_type', so you must take the address</pre>

<p>when passing to `ffi_prep_cif’.</p>

<p> File: libffi.info,  Node: Structures,  Next: Type Example,  Prev:
Primitive Types,  Up: Types</p>

<p>2.3.2 Structures</p>
<hr>

<p>Although `libffi’ has no special support for unions or bit-fields, it is
perfectly happy passing structures back and forth.  You must first describe
the structure to `libffi’ by creating a new `ffi_type’ object for it.</p>

<pre>-- ffi_type:
    The `ffi_type' has the following members:
   `size_t size'
         This is set by `libffi'; you should initialize it to zero.

   `unsigned short alignment'
         This is set by `libffi'; you should initialize it to zero.

   `unsigned short type'
         For a structure, this should be set to `FFI_TYPE_STRUCT'.

   `ffi_type **elements'
         This is a `NULL'-terminated array of pointers to `ffi_type'
         objects.  There is one element per field of the struct.</pre>

<p> File: libffi.info,  Node: Type Example,  Prev: Structures,  Up: Types</p>

<p>2.3.3 Type Example</p>
<hr>

<p>The following example initializes a `ffi_type’ object representing the `tm’
struct from Linux’s `time.h’.</p>

<pre>Here is how the struct is defined:

  struct tm {
      int tm_sec;
      int tm_min;
      int tm_hour;
      int tm_mday;
      int tm_mon;
      int tm_year;
      int tm_wday;
      int tm_yday;
      int tm_isdst;
      /* Those are for future use. */
      long int __tm_gmtoff__;
      __const char *__tm_zone__;
  };

Here is the corresponding code to describe this struct to `libffi':

      {
        ffi_type tm_type;
        ffi_type *tm_type_elements[12];
        int i;

        tm_type.size = tm_type.alignment = 0;
        tm_type.elements = &amp;tm_type_elements;

        for (i = 0; i &lt; 9; i++)
            tm_type_elements[i] = &amp;ffi_type_sint;

        tm_type_elements[9] = &amp;ffi_type_slong;
        tm_type_elements[10] = &amp;ffi_type_pointer;
        tm_type_elements[11] = NULL;

        /* tm_type can now be used to represent tm argument types and
      return types for ffi_prep_cif() */
      }</pre>

<p> File: libffi.info,  Node: Multiple ABIs,  Next: The Closure API,  Prev:
Types,  Up: Using libffi</p>

<p>2.4 Multiple ABIs</p>

<h6 id="label-"><span><a href="#label-">&para;</a> <a href="#documentation">&uarr;</a></span></h6>

<p>A given platform may provide multiple different ABIs at once.  For
instance, the x86 platform has both `stdcall’ and `fastcall’ functions.</p>

<pre>`libffi' provides some support for this.  However, this is</pre>

<p>necessarily platform-specific.</p>

<p> File: libffi.info,  Node: The Closure API,  Next: Closure Example,  Prev:
Multiple ABIs,  Up: Using libffi</p>

<p>2.5 The Closure API</p>

<h6 id="label-"><span><a href="#label-">&para;</a> <a href="#documentation">&uarr;</a></span></h6>

<p>`libffi’ also provides a way to write a generic function - a function that
can accept and decode any combination of arguments.  This can be useful
when writing an interpreter, or to provide wrappers for arbitrary
functions.</p>

<pre>This facility is called the &quot;closure API&quot;.  Closures are not</pre>

<p>supported on all platforms; you can check the `FFI_CLOSURES’ define to
determine whether they are supported on the current platform.</p>

<pre>Because closures work by assembling a tiny function at runtime, they</pre>

<p>require special allocation on platforms that have a non-executable heap. 
Memory management for closures is handled by a pair of functions:</p>

<pre>-- Function: void *ffi_closure_alloc (size_t SIZE, void **CODE)
    Allocate a chunk of memory holding SIZE bytes.  This returns a
    pointer to the writable address, and sets *CODE to the
    corresponding executable address.

    SIZE should be sufficient to hold a `ffi_closure' object.

-- Function: void ffi_closure_free (void *WRITABLE)
    Free memory allocated using `ffi_closure_alloc'.  The argument is
    the writable address that was returned.

  Once you have allocated the memory for a closure, you must construct</pre>

<p>a `ffi_cif’ describing the function call.  Finally you can prepare the
closure function:</p>

<pre>-- Function: ffi_status ffi_prep_closure_loc (ffi_closure *CLOSURE,
         ffi_cif *CIF, void (*FUN) (ffi_cif *CIF, void *RET, void
           ARGS, void *USER_DATA), void *USER_DATA, void *CODELOC)
    Prepare a closure function.

    CLOSURE is the address of a `ffi_closure' object; this is the
    writable address returned by `ffi_closure_alloc'.

    CIF is the `ffi_cif' describing the function parameters.

    USER_DATA is an arbitrary datum that is passed, uninterpreted, to
    your closure function.

    CODELOC is the executable address returned by `ffi_closure_alloc'.

    FUN is the function which will be called when the closure is
    invoked.  It is called with the arguments:
   CIF
         The `ffi_cif' passed to `ffi_prep_closure_loc'.

   RET
         A pointer to the memory used for the function's return value.
         FUN must fill this, unless the function is declared as
         returning `void'.

   ARGS
         A vector of pointers to memory holding the arguments to the
         function.

   USER_DATA
         The same USER_DATA that was passed to `ffi_prep_closure_loc'.

    `ffi_prep_closure_loc' will return `FFI_OK' if everything went ok,
    and something else on error.

    After calling `ffi_prep_closure_loc', you can cast CODELOC to the
    appropriate pointer-to-function type.

  You may see old code referring to `ffi_prep_closure'.  This function</pre>

<p>is deprecated, as it cannot handle the need for separate writable and
executable addresses.</p>

<p> File: libffi.info,  Node: Closure Example,  Prev: The Closure API,  Up:
Using libffi</p>

<p>2.6 Closure Example</p>

<h6 id="label-"><span><a href="#label-">&para;</a> <a href="#documentation">&uarr;</a></span></h6>

<p>A trivial example that creates a new `puts’ by binding `fputs’ with
`stdin’.</p>

<pre>#include &lt;stdio.h&gt;
#include &lt;ffi.h&gt;

/* Acts like puts with the file given at time of enclosure. */
void puts_binding(ffi_cif *cif, unsigned int *ret, void* args[],
                  FILE *stream)
{
   ret = fputs(*(char **)args[0], stream);
}

int main()
{
  ffi_cif cif;
  ffi_type *args[1];
  ffi_closure *closure;

  int (*bound_puts)(char *);
  int rc;

  /* Allocate closure and bound_puts */
  closure = ffi_closure_alloc(sizeof(ffi_closure), &amp;bound_puts);

  if (closure)
    {
      /* Initialize the argument info vectors */
      args[0] = &amp;ffi_type_pointer;

      /* Initialize the cif */
      if (ffi_prep_cif(&amp;cif, FFI_DEFAULT_ABI, 1,
                       &amp;ffi_type_uint, args) == FFI_OK)
        {
          /* Initialize the closure, setting stream to stdout */
          if (ffi_prep_closure_loc(closure, &amp;cif, puts_binding,
                                   stdout, bound_puts) == FFI_OK)
            {
              rc = bound_puts(&quot;Hello World!&quot;);
              /* rc now holds the result of the call to fputs */
            }
        }
    }

  /* Deallocate both closure, and bound_puts */
  ffi_closure_free(closure);

  return 0;
}</pre>

<p> File: libffi.info,  Node: Missing Features,  Next: Index,  Prev: Using
libffi,  Up: Top</p>

<p>3 Missing Features</p>

<pre>****************</pre>

<p>`libffi’ is missing a few features.  We welcome patches to add support for
these.</p>

<pre>There is no support for calling varargs functions.  This may work
on some platforms, depending on how the ABI is defined, but it is
not reliable.

There is no support for bit fields in structures.

The closure API is

The &quot;raw&quot; API is undocumented.</pre>

<p> File: libffi.info,  Node: Index,  Prev: Missing Features,  Up: Top</p>

<p>Index</p>

<pre>***</pre>

<p>[index]</p>

<pre>Menu:

:                                      Structures.           (line 12)
ABI:                                   Introduction.         (line 13)
Application Binary Interface:          Introduction.         (line 13)
calling convention:                    Introduction.         (line 13)
cif:                                   The Basics.           (line 14)
closure API:                           The Closure API.      (line 13)
closures:                              The Closure API.      (line 13)
FFI:                                   Introduction.         (line 31)
ffi_call:                              The Basics.           (line 41)
ffi_closure_alloc:                     The Closure API.      (line 19)
ffi_closure_free:                      The Closure API.      (line 26)
FFI_CLOSURES:                          The Closure API.      (line 13)
ffi_prep_cif:                          The Basics.           (line 16)
ffi_prep_closure_loc:                  The Closure API.      (line 34)
ffi_status &lt;1&gt;:                        The Closure API.      (line 37)
ffi_status:                            The Basics.           (line 18)
ffi_type:                              Structures.           (line 11)
ffi_type_double:                       Primitive Types.      (line 41)
ffi_type_float:                        Primitive Types.      (line 38)
ffi_type_longdouble:                   Primitive Types.      (line 71)
ffi_type_pointer:                      Primitive Types.      (line 75)
ffi_type_schar:                        Primitive Types.      (line 47)
ffi_type_sint:                         Primitive Types.      (line 62)
ffi_type_sint16:                       Primitive Types.      (line 23)
ffi_type_sint32:                       Primitive Types.      (line 29)
ffi_type_sint64:                       Primitive Types.      (line 35)
ffi_type_sint8:                        Primitive Types.      (line 17)
ffi_type_slong:                        Primitive Types.      (line 68)
ffi_type_sshort:                       Primitive Types.      (line 56)
ffi_type_uchar:                        Primitive Types.      (line 44)
ffi_type_uint:                         Primitive Types.      (line 59)
ffi_type_uint16:                       Primitive Types.      (line 20)
ffi_type_uint32:                       Primitive Types.      (line 26)
ffi_type_uint64:                       Primitive Types.      (line 32)
ffi_type_uint8:                        Primitive Types.      (line 14)
ffi_type_ulong:                        Primitive Types.      (line 65)
ffi_type_ushort:                       Primitive Types.      (line 53)
ffi_type_void:                         Primitive Types.      (line 10)
Foreign Function Interface:            Introduction.         (line 31)
void &lt;1&gt;:                              The Closure API.      (line 20)
void:                                  The Basics.           (line 43)</pre>

<p> Tag Table: Node: Top706 Node: Introduction1448 Node: Using libffi3084
Node: The Basics3570 Node: Simple Example6356 Node: Types7383 Node:
Primitive Types7666 Node: Structures9486 Node: Type Example10346 Node:
Multiple ABIs11569 Node: The Closure API11940 Node: Closure Example14884
Node: Missing Features16443 Node: Index16936  End Tag Table</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

