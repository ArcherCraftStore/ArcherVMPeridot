<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>aix.S - ffi-1.9.3-x86-mingw32 Documentation</title>

<link href="../../../../../fonts.css" rel="stylesheet">
<link href="../../../../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../../../";
</script>

<script src="../../../../../js/jquery.js"></script>
<script src="../../../../../js/navigation.js"></script>
<script src="../../../../../js/search_index.js"></script>
<script src="../../../../../js/search.js"></script>
<script src="../../../../../js/searcher.js"></script>
<script src="../../../../../js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../../../ext/ffi_c/libffi/ChangeLog.html">ChangeLog</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/ChangeLog_libffi.html">ChangeLog.libffi</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/ChangeLog_libgcj.html">ChangeLog.libgcj</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/ChangeLog_v1.html">ChangeLog.v1</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/Makefile_am.html">Makefile.am</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/Makefile_in.html">Makefile.in</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/Makefile_vc.html">Makefile.vc</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/Makefile_vc64.html">Makefile.vc64</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/README.html">README</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/acinclude_m4.html">acinclude.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/build-ios_sh.html">build-ios.sh</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/compile.html">compile</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/config_guess.html">config.guess</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/config_sub.html">config.sub</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/configure.html">configure</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/configure_ac.html">configure.ac</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/configure_host.html">configure.host</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/depcomp.html">depcomp</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/doc/libffi_info.html">libffi.info</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/doc/stamp-vti.html">stamp-vti</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/doc/version_texi.html">version.texi</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/fficonfig_h_in.html">fficonfig.h.in</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/include/Makefile_am.html">Makefile.am</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/include/Makefile_in.html">Makefile.in</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/install-sh.html">install-sh</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/libffi_pc_in.html">libffi.pc.in</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/libtool-version.html">libtool-version</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/ltmain_sh.html">ltmain.sh</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/m4/ax_cc_maxopt_m4.html">ax_cc_maxopt.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/m4/ax_cflags_warn_all_m4.html">ax_cflags_warn_all.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/m4/ax_check_compiler_flags_m4.html">ax_check_compiler_flags.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/m4/ax_compiler_vendor_m4.html">ax_compiler_vendor.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/m4/ax_configure_args_m4.html">ax_configure_args.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/m4/ax_enable_builddir_m4.html">ax_enable_builddir.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/m4/ax_gcc_archflag_m4.html">ax_gcc_archflag.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/m4/ax_gcc_x86_cpuid_m4.html">ax_gcc_x86_cpuid.m4</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/man/Makefile_am.html">Makefile.am</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/man/Makefile_in.html">Makefile.in</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/man/ffi_3.html">ffi.3</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/man/ffi_call_3.html">ffi_call.3</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/man/ffi_prep_cif_3.html">ffi_prep_cif.3</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/mdate-sh.html">mdate-sh</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/missing.html">missing</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/msvcc_sh.html">msvcc.sh</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/alpha/osf_S.html">osf.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/arm/gentramp_sh.html">gentramp.sh</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/arm/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/arm/trampoline_S.html">trampoline.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/avr32/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/cris/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/frv/eabi_S.html">eabi.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/ia64/unix_S.html">unix.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/m32r/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/m68k/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/mips/n32_S.html">n32.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/mips/o32_S.html">o32.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/moxie/eabi_S.html">eabi.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/pa/hpux32_S.html">hpux32.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/pa/linux_S.html">linux.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/powerpc/aix_S.html">aix.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/powerpc/aix_closure_S.html">aix_closure.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/powerpc/darwin_S.html">darwin.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/powerpc/darwin_closure_S.html">darwin_closure.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/powerpc/linux64_S.html">linux64.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/powerpc/linux64_closure_S.html">linux64_closure.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/powerpc/ppc_closure_S.html">ppc_closure.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/powerpc/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/s390/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/sh/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/sh64/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/sparc/v8_S.html">v8.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/sparc/v9_S.html">v9.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/x86/darwin_S.html">darwin.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/x86/darwin64_S.html">darwin64.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/x86/freebsd_S.html">freebsd.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/x86/sysv_S.html">sysv.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/x86/unix64_S.html">unix64.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/x86/win32_S.html">win32.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/src/x86/win64_S.html">win64.S</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/Makefile_am.html">Makefile.am</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/Makefile_in.html">Makefile.in</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/config/default_exp.html">default.exp</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/lib/libffi-dg_exp.html">libffi-dg.exp</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/lib/libffi_exp.html">libffi.exp</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/lib/target-libpath_exp.html">target-libpath.exp</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/lib/wrapper_exp.html">wrapper.exp</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/libffi_call/call_exp.html">call.exp</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/testsuite/libffi_special/special_exp.html">special.exp</a>
  
    <li><a href="../../../../../ext/ffi_c/libffi/texinfo_tex.html">texinfo.tex</a>
  
    <li><a href="../../../../../lib/ffi/platform/arm-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-cygwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-darwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-freebsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-gnu/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-netbsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-openbsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-solaris/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/i386-windows/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/ia64-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/mips-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/mipsel-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/powerpc-aix/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/powerpc-darwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/powerpc-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/s390-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/s390x-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/sparc-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/sparc-solaris/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/sparcv9-solaris/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/x86_64-cygwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/x86_64-darwin/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/x86_64-freebsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/x86_64-linux/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/x86_64-netbsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/x86_64-openbsd/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/x86_64-solaris/types_conf.html">types.conf</a>
  
    <li><a href="../../../../../lib/ffi/platform/x86_64-windows/types_conf.html">types.conf</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page ext/ffi_c/libffi/src/powerpc/aix.S">

<pre>-----------------------------------------------------------------------
aix.S - Copyright (c) 2002, 2009 Free Software Foundation, Inc.
based on darwin.S by John Hornkvist

PowerPC Assembly glue.

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
``Software''), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED ``AS IS'', WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY CLAIM, DAMAGES OR
OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
-----------------------------------------------------------------------   

     .set r0,0
     .set r1,1
     .set r2,2
     .set r3,3
     .set r4,4
     .set r5,5
     .set r6,6
     .set r7,7
     .set r8,8
     .set r9,9
     .set r10,10
     .set r11,11
     .set r12,12
     .set r13,13
     .set r14,14
     .set r15,15
     .set r16,16
     .set r17,17
     .set r18,18
     .set r19,19
     .set r20,20
     .set r21,21
     .set r22,22
     .set r23,23
     .set r24,24
     .set r25,25
     .set r26,26
     .set r27,27
     .set r28,28
     .set r29,29
     .set r30,30
     .set r31,31
     .set f0,0
     .set f1,1
     .set f2,2
     .set f3,3
     .set f4,4
     .set f5,5
     .set f6,6
     .set f7,7
     .set f8,8
     .set f9,9
     .set f10,10
     .set f11,11
     .set f12,12
     .set f13,13
     .set f14,14
     .set f15,15
     .set f16,16
     .set f17,17
     .set f18,18
     .set f19,19
     .set f20,20
     .set f21,21

     .extern .ffi_prep_args</pre>

<p>define LIBFFI_ASM include &lt;fficonfig.h&gt; include &lt;ffi.h&gt; define
JUMPTARGET(name) name define L(x) x</p>

<pre>     .file &quot;aix.S&quot;
     .toc

        void ffi_call_AIX(extended_cif *ecif, unsigned long bytes,
                  unsigned int flags, unsigned int *rvalue,
                  void (*fn)(),
                  void (*prep_args)(extended_cif*, unsigned *const));
 r3=ecif, r4=bytes, r5=flags, r6=rvalue, r7=fn, r8=prep_args
/</pre>

<p>.csect .<a href="PR">text</a></p>

<pre>.align 2
.globl ffi_call_AIX
.globl .ffi_call_AIX</pre>

<p>.csect <a href="DS">ffi_call_AIX</a> ffi_call_AIX: ifdef <em>64BIT</em></p>

<pre>.llong .ffi_call_AIX, TOC[tc0], 0
.csect .text[PR]</pre>

<p>.ffi_call_AIX:</p>

<pre>/* Save registers we use.    
mflr    r0

std     r28,-32(r1)
std     r29,-24(r1)
std     r30,-16(r1)
std     r31, -8(r1)

std     r0, 16(r1)
mr      r28, r1         /* our AP.  */
stdux   r1, r1, r4

/* Save arguments over call...  */
mr      r31, r5 /* flags, */
mr      r30, r6 /* rvalue, */
mr      r29, r7 /* function address.  */
std     r2, 40(r1)

/* Call ffi_prep_args.  */
mr      r4, r1
bl      .ffi_prep_args
nop

/* Now do the call.  */
ld      r0, 0(r29)
ld      r2, 8(r29)
ld      r11, 16(r29)
/* Set up cr1 with bits 4-7 of the flags.  */
mtcrf   0x40, r31
mtctr   r0
/* Load all those argument registers.  */
// We have set up a nice stack frame, just load it into registers.
ld      r3, 40+(1*8)(r1)
ld      r4, 40+(2*8)(r1)
ld      r5, 40+(3*8)(r1)
ld      r6, 40+(4*8)(r1)
nop
ld      r7, 40+(5*8)(r1)
ld      r8, 40+(6*8)(r1)
ld      r9, 40+(7*8)(r1)
ld      r10,40+(8*8)(r1)</pre>

<p>L1:</p>

<pre>/* Load all the FP registers.  */
bf      6,L2 // 2f + 0x18
lfd     f1,-32-(13*8)(r28)
lfd     f2,-32-(12*8)(r28)
lfd     f3,-32-(11*8)(r28)
lfd     f4,-32-(10*8)(r28)
nop
lfd     f5,-32-(9*8)(r28)
lfd     f6,-32-(8*8)(r28)
lfd     f7,-32-(7*8)(r28)
lfd     f8,-32-(6*8)(r28)
nop
lfd     f9,-32-(5*8)(r28)
lfd     f10,-32-(4*8)(r28)
lfd     f11,-32-(3*8)(r28)
lfd     f12,-32-(2*8)(r28)
nop
lfd     f13,-32-(1*8)(r28)</pre>

<p>L2:</p>

<pre>/* Make the call.  */
bctrl
ld      r2, 40(r1)

/* Now, deal with the return value.  */
mtcrf   0x01, r31

bt      30, L(done_return_value)
bt      29, L(fp_return_value)
std     r3, 0(r30)

/* Fall through...  */</pre>

<p>L(done_return_value):</p>

<pre>/* Restore the registers we used and return.  */
mr      r1, r28
ld      r0, 16(r28)
ld      r28, -32(r1)
mtlr    r0
ld      r29, -24(r1)
ld      r30, -16(r1)
ld      r31, -8(r1)
blr</pre>

<p>L(fp_return_value):</p>

<pre>bf      28, L(float_return_value)
stfd    f1, 0(r30)
bf      31, L(done_return_value)
stfd    f2, 8(r30)
b       L(done_return_value)</pre>

<p>L(float_return_value):</p>

<pre>stfs    f1, 0(r30)
b       L(done_return_value)</pre>

<p>else /* ! <em>64BIT</em> */</p>

<pre>.long .ffi_call_AIX, TOC[tc0], 0
.csect .text[PR]</pre>

<p>.ffi_call_AIX:</p>

<pre>/* Save registers we use.  */
mflr    r0

stw     r28,-16(r1)
stw     r29,-12(r1)
stw     r30, -8(r1)
stw     r31, -4(r1)

stw     r0, 8(r1)
mr      r28, r1         /* out AP.  */
stwux   r1, r1, r4

/* Save arguments over call...  */
mr      r31, r5 /* flags, */
mr      r30, r6 /* rvalue, */
mr      r29, r7 /* function address, */
stw     r2, 20(r1)

/* Call ffi_prep_args.  */
mr      r4, r1
bl      .ffi_prep_args
nop

/* Now do the call.  */
lwz     r0, 0(r29)
lwz     r2, 4(r29)
lwz     r11, 8(r29)
/* Set up cr1 with bits 4-7 of the flags.  */
mtcrf   0x40, r31
mtctr   r0
/* Load all those argument registers.  */
// We have set up a nice stack frame, just load it into registers.
lwz     r3, 20+(1*4)(r1)
lwz     r4, 20+(2*4)(r1)
lwz     r5, 20+(3*4)(r1)
lwz     r6, 20+(4*4)(r1)
nop
lwz     r7, 20+(5*4)(r1)
lwz     r8, 20+(6*4)(r1)
lwz     r9, 20+(7*4)(r1)
lwz     r10,20+(8*4)(r1)</pre>

<p>L1:</p>

<pre>/* Load all the FP registers.  */
bf      6,L2 // 2f + 0x18
lfd     f1,-16-(13*8)(r28)
lfd     f2,-16-(12*8)(r28)
lfd     f3,-16-(11*8)(r28)
lfd     f4,-16-(10*8)(r28)
nop
lfd     f5,-16-(9*8)(r28)
lfd     f6,-16-(8*8)(r28)
lfd     f7,-16-(7*8)(r28)
lfd     f8,-16-(6*8)(r28)
nop
lfd     f9,-16-(5*8)(r28)
lfd     f10,-16-(4*8)(r28)
lfd     f11,-16-(3*8)(r28)
lfd     f12,-16-(2*8)(r28)
nop
lfd     f13,-16-(1*8)(r28)</pre>

<p>L2:</p>

<pre>/* Make the call.  */
bctrl
lwz     r2, 20(r1)

/* Now, deal with the return value.  */
mtcrf   0x01, r31

bt      30, L(done_return_value)
bt      29, L(fp_return_value)
stw     r3, 0(r30)
bf      28, L(done_return_value)
stw     r4, 4(r30)

/* Fall through...  */</pre>

<p>L(done_return_value):</p>

<pre>/* Restore the registers we used and return.  */
mr      r1, r28
lwz     r0, 8(r28)
lwz     r28,-16(r1)
mtlr    r0
lwz     r29,-12(r1)
lwz     r30, -8(r1)
lwz     r31, -4(r1)
blr</pre>

<p>L(fp_return_value):</p>

<pre>bf      28, L(float_return_value)
stfd    f1, 0(r30)
b       L(done_return_value)</pre>

<p>L(float_return_value):</p>

<pre>stfs    f1, 0(r30)
b       L(done_return_value)</pre>

<p>endif</p>

<pre>.long 0
.byte 0,0,0,1,128,4,0,0</pre>

<p>//END(ffi_call_AIX)</p>

<p>.csect .<a href="PR">text</a></p>

<pre>.align 2
.globl ffi_call_DARWIN
.globl .ffi_call_DARWIN</pre>

<p>.csect <a href="DS">ffi_call_DARWIN</a> ffi_call_DARWIN: ifdef
<em>64BIT</em></p>

<pre>.llong .ffi_call_DARWIN, TOC[tc0], 0</pre>

<p>else</p>

<pre>.long .ffi_call_DARWIN, TOC[tc0], 0</pre>

<p>endif</p>

<pre>.csect .text[PR]</pre>

<p>.ffi_call_DARWIN:</p>

<pre>blr
.long 0
.byte 0,0,0,0,0,0,0,0</pre>

<p>//END(ffi_call_DARWIN)</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

